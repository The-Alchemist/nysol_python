#!/usr/bin/env python
# -*- coding: utf-8 -*-
import nysol.mcmd as n
import nysol.util.mtemp as mtemp

sampDAT1="""\
date,val
20160104,-0.03899819044
20160105,-0.05084821018
20160106,-0.0104518499
20160107,-0.02121253557
20160108,-0.02153397855
20160111,-0.04103062705
20160112,-0.01086976679
20160113,-0.007282023392
20160114,0.001320877262
20160115,0.01229161045
20160119,0.01312200972
20160120,0.01345514877
20160121,0.01793168078
20160122,0.03312638306
20160125,0.0002389703353
20160126,0.01609446496
20160127,0.01209267948
20160128,-0.03114883198
20160129,-0.04485946673
20160201,-0.02677999413
20160202,-0.0319609966
20160203,-0.0457889159
20160204,-0.007789610035
20160205,0.02288096252
20160208,0.04002503737
20160209,0.03554828218
20160210,0.04782335691
20160211,0.04275956054
20160212,0.01378848497
20160216,0.001747812602
20160217,0.0177618575
20160218,0.01591776416
20160219,-0.006657389977
20160222,0.02966578602
20160223,0.02932033544
20160224,0.02147071291
20160225,0.02664678688
20160226,0.03565273276
20160229,0.000543829969
20160301,0.001501902263
20160302,-0.001840964611
20160303,0.01124862844
20160304,0.009102614909
20160307,0.01850576257
20160308,0.01905376212
20160309,0.02549316407
20160310,0.0135032501
20160311,0.01574982698
20160314,0.01670942402
20160315,0.004723042269
20160316,-0.002250257227
20160317,-0.006110643099
20160318,0.001720460293
20160321,0.006948168095
20160322,0.01129437888
20160323,0.01800333571
20160324,0.01424988128
20160328,-0.004711359688
20160329,0.001445980478
20160330,-0.008490086507
20160331,-0.01203437598
20160401,-0.01156591719
20160404,0.00824079591
20160405,0.00777327259
20160406,0.01992199346
20160407,0.01615112538
20160408,0.02543189191
20160411,0.01885425256
20160412,0.009575706542
20160413,0.004208766826
20160414,0.005240841278
20160415,-0.003112159594
20160418,-0.004323869823
20160419,-0.00343610834
20160420,-0.007472887073
20160421,-0.01258378391
20160422,-0.002961753253
20160425,-0.01351127403
20160426,-0.02109753979
20160427,-0.012105591
20160428,-0.003867873056
20160429,0.01092440318
20160502,-0.01023599068
20160503,-0.006611329951
20160504,-0.006680687964
20160505,-0.0049721765
20160506,0.004071038414
20160509,-0.01782394907
20160510,-0.008057241424
20160511,-0.01159442992
20160512,0.002903290218
20160513,-0.008978842729
20160516,0.01411385136
20160517,-0.02088344435
20160518,0.02437969677
20160519,0.02264708318
20160520,0.02373208013
20160523,0.01118091426
20160524,0.007030874751
20160525,-0.004329592318
20160526,0.004939983055
20160527,0.007229890961
20160531,0.009409138806
20160601,0.004866733928
20160602,-0.001396734349
20160603,-0.0144091883
20160606,-0.01749753827
20160607,-0.02264767365
20160608,-0.0177969841
20160609,0.01187971746
20160610,-0.002043640563
20160613,-0.00655463893
20160614,0.006743731962
20160615,-0.0169747587
20160616,0.01568707028
20160617,-0.03959174619
20160620,-0.02453365262
20160621,-0.00584941976
20160622,-0.00564843952
20160623,0.03222002236
20160624,0.04346900352
20160627,0.03105179757
20160628,0.01314761105
20160629,0.01483595725
20160630,0.01629589108
20160701,0.03015271686
20160705,0.02493447036
20160706,0.03106518318
20160707,0.01488289178
20160708,0.0138566212
20160711,0.005412082458
20160712,0.009547637603
20160713,-0.0006759814044
20160714,-0.006158839147
20160715,0.000765046279
20160718,0.002523089714
20160719,-0.002945824643
20160720,0.00227287746
20160721,-0.0006497461743
20160722,-0.001091923693
20160725,0.005592475814
20160726,-0.001259927406
20160727,0.002653555555
20160728,0.004318595445
20160729,-0.004681315574
20160801,-0.01143265746
20160802,-0.005434032681
20160803,-0.009956008281
20160804,-0.0005565151241
20160805,-0.004256554195
20160808,0.00161227172
20160809,-0.003120972445
20160810,-0.0005860018072
20160811,5.8263383e-05
20160812,0.003414460072
20160815,0.004016381539
20160816,-0.003092471122
20160817,-0.006657307085
20160818,-0.006795839078
20160819,-0.001004499388
20160822,0.004910052095
20160823,0.002045545714
20160824,0.0007217611642
20160825,-0.0050581869
20160826,-0.002811746279
20160829,0.004619180194
20160830,0.004771892215
20160831,-0.01970872527
20160901,0.009232762965
20160902,0.02704510718
20160906,0.02748642987
20160907,0.01515407575
20160908,0.005595748959
20160909,0.009100012299
20160912,-0.006029841632
20160913,-0.01753463049
20160914,-0.01392522299
20160915,-0.01196069351
20160916,0.003391557691
20160919,-0.009536616945
20160920,0.003915972686
20160921,-0.01190520193
20160922,0.001799482078
20160923,0.007126652794
20160926,-0.004273175144
20160927,-0.005272947913
20160928,0.004529897822
20160929,-0.006691477247
20160930,0.001175128078
20161003,-0.006315794379
20161004,-0.009465877672
20161005,-0.01304673778
20161006,-0.00959163141
20161007,0.01723557587
20161010,-0.001371284213
20161011,-0.002416670838
20161012,-0.004140242517
20161013,-0.003854546465
20161014,-0.01164231144
20161017,-0.001684303294
20161018,-0.002248115897
20161019,-0.003859145998
20161020,-0.006883326367
20161021,-0.01175535999
20161024,-0.01474462455
"""


temo = mtemp.Mtemp()
vv = temo.file()
with open(vv,"w") as wfp:
	wfp.write(sampDAT1)

rls=[]
xxx1 = n.mcal(i=vv,c="left($s{date},6)",a="month").msetstr(a="ccc",v="")
xxx2 = xxx1.msum({"k":"date","f":"val"})
xxx3 = xxx1.msum({"k":"date","f":"val"},o=rls)
xxx3.run()
print(rls)

for x in xxx2.keyblock(["month"]):
	print(x)

for x in xxx2:
	if x[3] == "201608":
		print(x)

